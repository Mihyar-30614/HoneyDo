<ion-header class="ion-no-border">
	<ion-toolbar>
		<ion-buttons slot="start">
			<ion-button (click)="router.navigate(['/home'])">
				<ion-icon name="arrow-back"></ion-icon>
			</ion-button>
		</ion-buttons>
		<ion-title class="ion-text-center">{{ project?.name || 'Todos' }}</ion-title>
	</ion-toolbar>
</ion-header>

<ion-content>
	<div class="todo-stats">
		<div class="stat-item total">
			<ion-icon name="list-outline"></ion-icon>
			<div class="stat-content">
				<div class="stat-value">{{ todos.length }}</div>
				<div class="stat-label">Total</div>
			</div>
		</div>
		<div class="stat-item new">
			<ion-icon name="time-outline"></ion-icon>
			<div class="stat-content">
				<div class="stat-value">{{ newTodosCount }}</div>
				<div class="stat-label">New</div>
			</div>
		</div>
		<div class="stat-item in-progress">
			<ion-icon name="hourglass-outline"></ion-icon>
			<div class="stat-content">
				<div class="stat-value">{{ inProgressTodosCount }}</div>
				<div class="stat-label">In Progress</div>
			</div>
		</div>
		<div class="stat-item done">
			<ion-icon name="checkmark-circle-outline"></ion-icon>
			<div class="stat-content">
				<div class="stat-value">{{ doneTodosCount }}</div>
				<div class="stat-label">Done</div>
			</div>
		</div>
	</div>

	<ion-fab vertical="bottom" horizontal="end" slot="fixed">
		<ion-fab-button color="warning" (click)="showAddTodoModal = true">
			<ion-icon name="add"></ion-icon>
		</ion-fab-button>
	</ion-fab>

	<ion-modal mode="ios" [isOpen]="showAddTodoModal" (didDismiss)="showAddTodoModal = false">
		<ng-template>
			<ion-header>
				<ion-toolbar>
					<ion-title>New Todo</ion-title>
					<ion-buttons slot="end">
						<ion-button (click)="showAddTodoModal = false">Cancel</ion-button>
					</ion-buttons>
				</ion-toolbar>
			</ion-header>
			<ion-content class="ion-padding">
				<div class="add-section add-todo">
					<ion-input [(ngModel)]="newTodoTitle" placeholder="Todo title"
						(ionChange)="newTodoTitle = $event.detail.value || ''"></ion-input>
					<ion-button expand="block" (click)="addTodo(); showAddTodoModal = false;"
						[disabled]="!newTodoTitle.trim()">
						Add Todo
					</ion-button>
				</div>
			</ion-content>
		</ng-template>
	</ion-modal>

	<!-- Active Todos -->
	<div *ngIf="todos.length === 0" class="empty-state">
		<ion-icon name="checkbox-outline"></ion-icon>
		<h3>No Active Todos</h3>
		<p>Add a new todo to get started</p>
	</div>
	<ion-grid>
		<ion-row>
			<ion-col size="12" *ngFor="let todo of todos | orderBy: ['status']: ['in-progress', 'new', 'done']">
				<div class="todo-item" [class]="todo.status">
					<ion-label>
						<h2 [class.line-through]="todo.status === 'done'">{{ todo.title }}</h2>
						<p>Created: {{ todo.createdAt?.toDate() | date:'short' }}</p>
					</ion-label>
					<ion-badge class="status-badge" [class]="todo.status">
						{{ todo.status }}
					</ion-badge>
					<ion-button fill="clear" size="small" class="actions-menu"
						(click)="todo.showActions = !todo.showActions">
						<ion-icon name="ellipsis-vertical"></ion-icon>
					</ion-button>
					<div class="todo-actions-dropdown" *ngIf="todo.showActions">
						<ion-list>
							<ion-item button (click)="cycleStatus(todo); todo.showActions = false"><ion-icon
									slot="start"
									[name]="todo.status === 'done' ? 'checkmark-circle' : 'ellipse-outline'"></ion-icon>Change
								Status</ion-item>
							<ion-item button (click)="editT(todo); todo.showActions = false"><ion-icon slot="start"
									name="create"></ion-icon>Edit</ion-item>
							<ion-item button (click)="archiveTodo(todo.id); todo.showActions = false"><ion-icon
									slot="start" name="archive"></ion-icon>Archive</ion-item>
							<ion-item button (click)="deleteTodo(todo.id); todo.showActions = false"><ion-icon
									slot="start" name="trash"></ion-icon>Delete</ion-item>
						</ion-list>
					</div>
				</div>
			</ion-col>
		</ion-row>
	</ion-grid>

	<h2 class="section-title">Archived Todos</h2>
	<div *ngIf="archivedTodos.length === 0" class="empty-state">
		<ion-icon name="archive-outline"></ion-icon>
		<h3>No Archived Todos</h3>
		<p>Archived todos will appear here</p>
	</div>
	<ion-grid>
		<ion-row>
			<ion-col size="12" *ngFor="let todo of archivedTodos">
				<div class="todo-item">
					<ion-label>
						<h2>{{ todo.title }}</h2>
						<p>Created: {{ todo.createdAt?.toDate() | date:'short' }}</p>
					</ion-label>
					<ion-badge class="status-badge" [class]="todo.status">
						{{ todo.status }}
					</ion-badge>
					<div class="actions">
						<ion-button fill="clear" (click)="unarchiveTodo(todo.id)">
							<ion-icon name="refresh"></ion-icon>
						</ion-button>
						<ion-button fill="clear" (click)="deleteTodo(todo.id)">
							<ion-icon name="trash"></ion-icon>
						</ion-button>
					</div>
				</div>
			</ion-col>
		</ion-row>
	</ion-grid>

	<!-- Edit Todo Modal -->
	<ion-modal mode="ios" [isOpen]="editingTodo !== null" (didDismiss)="cancelTodoEdit()">
		<ng-template>
			<ion-header>
				<ion-toolbar>
					<ion-title>Edit Todo</ion-title>
					<ion-buttons slot="end">
						<ion-button (click)="cancelTodoEdit()">Cancel</ion-button>
					</ion-buttons>
				</ion-toolbar>
			</ion-header>
			<ion-content class="ion-padding">
				<div class="add-section add-todo">
					<ion-input [(ngModel)]="editTodoTitle" placeholder="Todo title"
						(ionChange)="editTodoTitle = $event.detail.value || ''"></ion-input>
				</div>
				<ion-button expand="block" (click)="updateTodo()" [disabled]="!editTodoTitle.trim()">
					Save Changes
				</ion-button>
			</ion-content>
		</ng-template>
	</ion-modal>
</ion-content>
