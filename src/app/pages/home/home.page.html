<ion-content class="ion-padding bg-yellow-50">
	<!-- Active Projects -->
	<section class="mb-6">
		<h2 class="text-xl font-semibold text-yellow-800 mb-2">Projects</h2>
		<div class="flex space-x-4 overflow-auto pb-2">
			<ng-container *ngFor="let p of projects">
				<div class="group flex-none bg-white rounded-2xl shadow p-4 min-w-[140px]"
					[ngClass]="{ 'ring ring-yellow-500': selectedProject?.id === p.id }">
					<div *ngIf="editingProject?.id !== p.id" class="flex items-center justify-between">
						<p class="font-medium text-yellow-700 truncate">{{ p.name }}</p>
						<div class="flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity">
							<ion-button fill="clear" size="small" (click)="editProj(p)">
								<ion-icon name="create-outline" color="warning"></ion-icon>
							</ion-button>
							<ion-button fill="clear" size="small" (click)="archiveProject(p.id)">
								<ion-icon name="archive-outline" color="medium"></ion-icon>
							</ion-button>
						</div>
					</div>
					<!-- Editing Mode -->
					<div *ngIf="editingProject?.id === p.id" class="space-y-2">
						<ion-input [(ngModel)]="editProjectName" placeholder="Project name"
							class="bg-yellow-50 rounded-full px-3"></ion-input>
						<div class="flex justify-end space-x-2">
							<ion-button fill="clear" (click)="cancelProjectEdit()" color="medium">Cancel</ion-button>
							<ion-button fill="solid" color="warning" (click)="updateProject()">Save</ion-button>
						</div>
					</div>
				</div>
			</ng-container>
			<!-- Add Project -->
			<div class="flex-none flex items-center space-x-2">
				<ion-input [(ngModel)]="newProjectName" placeholder="New project" class="bg-white rounded-full px-4"
					[disabled]="loading"></ion-input>
				<ion-button fill="solid" color="warning" (click)="addProject()" [disabled]="!newProjectName.trim()"
					class="rounded-full shadow px-3">
					<ion-icon name="add-outline" slot="icon-only" color="light"></ion-icon>
				</ion-button>
			</div>
		</div>
	</section>

	<!-- Archived Projects -->
	<section *ngIf="archivedProjects?.length">
		<h3 class="text-lg font-medium text-gray-600 mb-2">Archived Projects</h3>
		<div class="flex space-x-4 overflow-auto pb-2">
			<div *ngFor="let ap of archivedProjects"
				class="flex-none bg-gray-100 rounded-2xl shadow p-4 min-w-[140px] group">
				<div class="flex items-center justify-between">
					<p class="font-medium text-gray-700 truncate line-through">{{ ap.name }}</p>
					<ion-button fill="clear" size="small" (click)="unarchiveProject(ap.id)">
						<ion-icon name="arrow-undo-outline" color="warning"></ion-icon>
					</ion-button>
				</div>
			</div>
		</div>
	</section>

	<!-- Todos Section -->
	<section *ngIf="selectedProject">
		<h2 class="text-xl font-semibold text-yellow-800 mb-2">{{ selectedProject.name }}</h2>
		<div class="space-y-3">
			<!-- Todo Items -->
			<div *ngFor="let t of todos"
				class="group bg-white rounded-full shadow flex items-center justify-between p-3">
				<div class="flex items-center">
					<ion-checkbox slot="start" [(ngModel)]="t.completed" (ionChange)="toggleTodo(t)"
						color="warning"></ion-checkbox>
					<span [class.line-through]="t.completed" class="text-gray-800 ml-2 truncate">{{ t.title }}</span>
				</div>
				<div class="flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity">
					<ion-button fill="clear" size="small" (click)="editT(t)">
						<ion-icon name="create-outline" color="warning"></ion-icon>
					</ion-button>
					<ion-button fill="clear" size="small" (click)="archiveTodo(t.id)">
						<ion-icon name="archive-outline" color="medium"></ion-icon>
					</ion-button>
				</div>
			</div>

			<!-- Archived Todos -->
			<div *ngIf="archivedTodos?.length" class="mt-4">
				<h3 class="text-lg font-medium text-gray-600 mb-2">Archived Tasks</h3>
				<div class="space-y-2">
					<div *ngFor="let at of archivedTodos"
						class="bg-gray-100 rounded-full shadow flex items-center justify-between p-3">
						<span class="text-gray-500 line-through">{{ at.title }}</span>
						<ion-button fill="clear" size="small" (click)="unarchiveTodo(at.id)">
							<ion-icon name="arrow-undo-outline" color="warning"></ion-icon>
						</ion-button>
					</div>
				</div>
			</div>

			<!-- Add Todo -->
			<div class="flex items-center space-x-2 mt-4">
				<ion-input [(ngModel)]="newTodoTitle" placeholder="New task" class="flex-1 bg-white rounded-full px-4"
					[disabled]="!selectedProject"></ion-input>
				<ion-button fill="solid" color="warning" (click)="addTodo()" [disabled]="!newTodoTitle.trim()"
					class="rounded-full shadow px-3">
					<ion-icon name="add-outline" slot="icon-only" color="light"></ion-icon>
				</ion-button>
			</div>
		</div>
	</section>
</ion-content>
